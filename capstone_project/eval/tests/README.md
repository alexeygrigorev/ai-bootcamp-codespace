# Agent Response Unit Tests

This directory contains unit tests for validating the SEC Cybersecurity Agent's responses.

## Test Structure

- `agent_tests/test_response_validation.py`: Tests for validating agent responses from stress tests
- `conftest.py`: Pytest configuration and shared fixtures

## Setup

Install pytest (if not already installed):
```bash
cd /Users/ddegeest/my-code-projects/ai-bootcamp-codespace
poetry add --group dev pytest
poetry install --with dev
```

Or install directly:
```bash
pip install pytest
```

## Running Tests

### Run all tests
```bash
cd capstone_project
poetry run pytest tests/ -v
```

### Run specific test file
```bash
poetry run pytest tests/agent_tests/test_response_validation.py -v
```

### Run specific test class
```bash
poetry run pytest tests/agent_tests/test_response_validation.py::TestResponseValidation -v
```

### Run specific test
```bash
poetry run pytest tests/agent_tests/test_response_validation.py::TestResponseValidation::test_no_forbidden_phrases -v
```

## Test Coverage

### Response Validation Tests (`TestResponseValidation`)

1. **`test_no_forbidden_phrases`**: Ensures responses don't contain phrases indicating general knowledge usage
2. **`test_cik_accuracy`**: Validates that responses use correct CIKs (no wrong company mappings)
3. **`test_subsidiary_mapping`**: Checks that subsidiaries are correctly mapped to parent companies
4. **`test_sec_citations_when_filings_found`**: Ensures responses cite SEC forms when information is provided
5. **`test_response_structure`**: Validates that responses have proper structure (not empty)
6. **`test_historical_name_mapping`**: Checks that historical names (Yahoo → Altaba) are correctly mapped

### CIK Lookup Tests (`TestCIKLookup`)

1. **`test_change_healthcare_maps_to_unitedhealth`**: Validates Change Healthcare → UnitedHealth Group mapping
2. **`test_sony_pictures_maps_to_sony_group`**: Validates Sony Pictures → Sony Group Corp mapping
3. **`test_yahoo_maps_to_altaba_cik`**: Validates Yahoo → Altaba CIK mapping
4. **`test_ticker_symbol_lookup`**: Tests ticker symbol to CIK mappings

## Adding New Tests

To add new tests:

1. Add test methods to existing test classes in `test_response_validation.py`
2. Or create new test files following the naming convention `test_*.py`
3. Use pytest fixtures from `conftest.py` for shared setup
4. Follow the existing patterns for assertions and error messages

## Test Data

Tests use `stress_test_results.json` from the project root. This file is generated by running `run_stress_tests.py`.

## Continuous Integration

These tests can be integrated into CI/CD pipelines to ensure agent quality remains consistent across changes.

